const __vite__fileDeps=["assets/index-CrUjKI9_.js","assets/index-D5SrGHtZ.css","assets/hashMessage-CLhnMS1a.js","assets/checkContractWalletSignature-pJfyYmvg.js","assets/isValidSignature-DA5wEesC.js","assets/checkContractWalletSignedTypedData-CcMGEW_w.js","assets/send-eip712-transaction-Df1EitOH.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-aYp195_m.js","assets/sha256-BjnSc-uN.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{B as xt,t as nt,i as Dt,a as Lt,b as C,A as _t,c as Y,f as st,k as v,d as rt,e as B,I as Q,g as Et,h as it,D as ot,j as ct,l as Ct,P as Ut,m as N,s as It,n as St,v as Vt,o as _,p as O,q as Ft,r as U,u as Nt,w as k,x as Mt,E as x,y as j,z as dt,C as Rt,F as w,M as $t,G as Ht,H as ut,J as z,K as D,L as pt,N as Bt,O as W,Q as M,R as kt,S as jt,T as lt,U as L,V as zt,W as Wt,X as qt,Y as Kt,_ as b,Z as mt,$ as Jt,a0 as Zt,a1 as Yt}from"./index-CrUjKI9_.js";import{populateEip712Transaction as Qt,signEip712Transaction as Xt}from"./send-eip712-transaction-Df1EitOH.js";import{concatHex as te}from"./concat-hex-aYp195_m.js";import{m as ee}from"./sha256-BjnSc-uN.js";class ae extends xt{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const V=nt;function ne(t){const{abi:e,args:a=[],name:n}=t,s=Dt(n,{strict:!1}),r=e.filter(i=>s?i.type==="function"?Lt(i)===n:i.type==="event"?V(i)===n:!1:"name"in i&&i.name===n);if(r.length===0)return;if(r.length===1)return r[0];let o;for(const i of r){if(!("inputs"in i))continue;if(!a||a.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==a.length)continue;if(a.every((d,u)=>{const p="inputs"in i&&i.inputs[u];return p?R(d,p):!1})){if(o&&"inputs"in o&&o.inputs){const d=yt(i.inputs,o.inputs,a);if(d)throw new _t({abiItem:i,type:d[0]},{abiItem:o,type:d[1]})}o=i}}return o||r[0]}function R(t,e){const a=typeof t,n=e.type;switch(n){case"address":return C(t,{strict:!1});case"bool":return a==="boolean";case"function":return a==="string";case"string":return a==="string";default:return n==="tuple"&&"components"in e?Object.values(e.components).every((s,r)=>R(Object.values(t)[r],s)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(n)?a==="number"||a==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(n)?a==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(n)?Array.isArray(t)&&t.every(s=>R(s,{...e,type:n.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function yt(t,e,a){for(const n in t){const s=t[n],r=e[n];if(s.type==="tuple"&&r.type==="tuple"&&"components"in s&&"components"in r)return yt(s.components,r.components,a[n]);const o=[s.type,r.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?C(a[n],{strict:!1}):o.includes("address")&&o.includes("bytes")?C(a[n],{strict:!1}):!1)return o}}const X="/docs/contract/encodeEventTopics";function se(t){var c;const{abi:e,eventName:a,args:n}=t;let s=e[0];if(a){const d=ne({abi:e,name:a});if(!d)throw new Y(a,{docsPath:X});s=d}if(s.type!=="event")throw new Y(void 0,{docsPath:X});const r=st(s),o=V(r);let i=[];if(n&&"inputs"in s){const d=(c=s.inputs)==null?void 0:c.filter(p=>"indexed"in p&&p.indexed),u=Array.isArray(n)?n:Object.values(n).length>0?(d==null?void 0:d.map(p=>n[p.name]))??[]:[];u.length>0&&(i=(d==null?void 0:d.map((p,y)=>Array.isArray(u[y])?u[y].map((A,f)=>tt({param:p,value:u[y][f]})):u[y]?tt({param:p,value:u[y]}):null))??[])}return[o,...i]}function tt({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return v(rt(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new ae(t.type);return B([t],[e])}function re(t,e){if(!C(t,{strict:!1}))throw new Q({address:t});if(!C(e,{strict:!1}))throw new Q({address:e});return t.toLowerCase()===e.toLowerCase()}const et="/docs/contract/decodeEventLog";function ie(t){const{abi:e,data:a,strict:n,topics:s}=t,r=n??!0,[o,...i]=s;if(!o)throw new Et({docsPath:et});const c=e.length===1?e[0]:e.find(m=>m.type==="event"&&o===V(st(m)));if(!(c&&"name"in c)||c.type!=="event")throw new it(o,{docsPath:et});const{name:d,inputs:u}=c,p=u==null?void 0:u.some(m=>!("name"in m&&m.name));let y=p?[]:{};const A=u.filter(m=>"indexed"in m&&m.indexed);for(let m=0;m<A.length;m++){const G=A[m],g=i[m];if(!g)throw new ot({abiItem:c,param:G});y[p?m:G.name||m]=oe({param:G,value:g})}const f=u.filter(m=>!("indexed"in m&&m.indexed));if(f.length>0){if(a&&a!=="0x")try{const m=ct(f,a);if(m)if(p)y=[...y,...m];else for(let G=0;G<f.length;G++)y[f[G].name]=m[G]}catch(m){if(r)throw m instanceof Ct||m instanceof Ut?new N({abiItem:c,data:a,params:f,size:It(a)}):m}else if(r)throw new N({abiItem:c,data:"0x",params:f,size:0})}return{eventName:d,args:Object.values(y).length>0?y:void 0}}function oe({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(ct([t],e)||[])[0]}function ce(t){const{abi:e,args:a,logs:n,strict:s=!0}=t,r=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return n.map(o=>{var i;try{const c=e.find(u=>u.type==="event"&&o.topics[0]===V(u));if(!c)return null;const d=ie({...o,abi:[c],strict:s});return r&&!r.includes(d.eventName)||!de({args:d.args,inputs:c.inputs,matchArgs:a})?null:{...d,...o}}catch(c){let d,u;if(c instanceof it)return null;if(c instanceof N||c instanceof ot){if(s)return null;d=c.abiItem.name,u=(i=c.abiItem.inputs)==null?void 0:i.some(p=>!("name"in p&&p.name))}return{...o,args:u?[]:{},eventName:d}}}).filter(Boolean)}function de(t){const{args:e,inputs:a,matchArgs:n}=t;if(!n)return!0;if(!e)return!1;function s(r,o,i){try{return r.type==="address"?re(o,i):r.type==="string"||r.type==="bytes"?v(rt(o))===i:o===i}catch{return!1}}return Array.isArray(e)&&Array.isArray(n)?n.every((r,o)=>{if(r===null)return!0;const i=a[o];return i?(Array.isArray(r)?r:[r]).some(d=>s(i,d,e[o])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof n=="object"&&!Array.isArray(n)?Object.entries(n).every(([r,o])=>{if(o===null)return!0;const i=a.find(d=>d.name===r);return i?(Array.isArray(o)?o:[o]).some(d=>s(i,d,e[r])):!1}):!1}function ue(t){const{domain:e={},message:a,primaryType:n}=t,s={EIP712Domain:St({domain:e}),...t.types};Vt({domain:e,message:a,primaryType:n,types:s});const r=["0x1901"];return e&&r.push(pe({domain:e,types:s})),n!=="EIP712Domain"&&r.push(ft({data:a,primaryType:n,types:s})),v(_(r))}function pe({domain:t,types:e}){return ft({data:t,primaryType:"EIP712Domain",types:e})}function ft({data:t,primaryType:e,types:a}){const n=gt({data:t,primaryType:e,types:a});return v(n)}function gt({data:t,primaryType:e,types:a}){const n=[{type:"bytes32"}],s=[le({primaryType:e,types:a})];for(const r of a[e]){const[o,i]=At({types:a,name:r.name,type:r.type,value:t[r.name]});n.push(o),s.push(i)}return B(n,s)}function le({primaryType:t,types:e}){const a=O(me({primaryType:t,types:e}));return v(a)}function me({primaryType:t,types:e}){let a="";const n=ht({primaryType:t,types:e});n.delete(t);const s=[t,...Array.from(n).sort()];for(const r of s)a+=`${r}(${e[r].map(({name:o,type:i})=>`${i} ${o}`).join(",")})`;return a}function ht({primaryType:t,types:e},a=new Set){const n=t.match(/^\w*/u),s=n==null?void 0:n[0];if(a.has(s)||e[s]===void 0)return a;a.add(s);for(const r of e[s])ht({primaryType:r.type,types:e},a);return a}function At({types:t,name:e,type:a,value:n}){if(t[a]!==void 0)return[{type:"bytes32"},v(gt({data:n,primaryType:a,types:t}))];if(a==="bytes")return n=`0x${(n.length%2?"0":"")+n.slice(2)}`,[{type:"bytes32"},v(n)];if(a==="string")return[{type:"bytes32"},v(O(n))];if(a.lastIndexOf("]")===a.length-1){const s=a.slice(0,a.lastIndexOf("[")),r=n.map(o=>At({name:e,type:s,types:t,value:o}));return[{type:"bytes32"},v(B(r.map(([o])=>o),r.map(([,o])=>o)))]}return[{type:a},n]}function ye(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function Gt(t){const{signature:e}=t;let a;return ye(e)?a=e:a=Ft(e),{abiEvent:a,hash:nt(a),topics:se({abi:[a],args:t.filters})}}function fe(t){const{logs:e,events:a,strict:n}=t;return ce({logs:e,abi:a.map(s=>s.abiEvent),strict:n})}const ge="0xdd62ed3e",he=[{type:"address",name:"owner"},{type:"address",name:"spender"}],Ae=[{type:"uint256"}];async function Ge(t){return U({contract:t.contract,method:[ge,he,Ae],params:[t.owner,t.spender]})}async function we(t){if(t.id===1337||t.id===31337)return!1;if(t.id===324||t.id===300||t.id===302||t.id===11124||t.id===282||t.id===388||t.id===4654||t.id===333271||t.id===37111)return!0;try{return(await Nt(t)).stackType==="zksync_stack"}catch{return!1}}function be(t={}){return Gt({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function ve(t={}){return Gt({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Oe(t){const{receipt:e}=t,a={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(a.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(a.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:a,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const Te=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|a<<BigInt(96)|n<<BigInt(64)|s<<BigInt(32)|r};function q(t){return Object.fromEntries(Object.entries(t).map(([e,a])=>[e,a==null||k(a)?a:Mt(a)]))}async function Pe(t){return E({...t,operation:"eth_sendUserOperation",params:[q(t.userOp),t.options.entrypointAddress??x]})}async function I(t){const e=await E({...t,operation:"eth_estimateUserOperationGas",params:[q(t.userOp),t.options.entrypointAddress??x]});return{preVerificationGas:w(e.preVerificationGas),verificationGas:w(e.verificationGas),verificationGasLimit:w(e.verificationGasLimit),callGasLimit:w(e.callGasLimit)+$t,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?w(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?w(e.paymasterPostOpGasLimit):void 0}}async function xe(t){const e=await E({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:w(e.maxPriorityFeePerGas),maxFeePerGas:w(e.maxFeePerGas)}}async function De(t){var a,n;const e=await Le(t);if(e){if(e.success===!1){const r=(n=(a=fe({events:[be(),ve()],logs:e.logs})[0])==null?void 0:a.args)==null?void 0:n.revertReason;if(!r)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=Ht({data:r});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Le(t){const e=await E({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return Oe(e)}async function _e(t){const e=await E({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function Ee(t){return{transactionHash:(await E({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function E(t){const{options:e,operation:a,params:n}=t,s=e.bundlerUrl??j(e.chain),o=await dt(e.client)(s,{method:"POST",headers:{"Content-Type":"application/json"},body:Rt({jsonrpc:"2.0",id:1,method:a,params:n})}),i=await o.json();if(!o.ok||i.error){let c=i.error||o.statusText;typeof c=="object"&&(c=JSON.stringify(c));const d=i.code||"UNKNOWN";throw new Error(`${a} error: ${c}
Status: ${o.status}
Code: ${d}`)}return i.result}async function Ce(t){const{factoryContract:e,predictAddressOverride:a,adminAddress:n,accountSalt:s,accountAddress:r}=t;if(a)return a(e);if(r)return r;if(!n)throw new Error("Account address is required to predict the smart wallet address.");const o=s&&k(s)?s:ut(s??"");return U({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[n,o]})}function wt(t){const{adminAddress:e,factoryContract:a,createAccountOverride:n,accountSalt:s}=t;if(n)return n(a);const r=s&&k(s)?s:ut(s??"");return z({contract:a,method:"function createAccount(address, bytes) returns (address)",params:[e,r]})}function bt(t){const{accountContract:e,transaction:a,executeOverride:n}=t;return n?n(e,a):z({contract:e,method:"function execute(address, uint256, bytes)",params:[a.to||"",a.value||0n,a.data||"0x"],gas:a.gas?a.gas+21000n:void 0})}function Ue(t){const{accountContract:e,transactions:a,executeBatchOverride:n}=t;return n?n(e,a):z({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map(s=>s.to||""),a.map(s=>s.value||0n),a.map(s=>s.data||"0x")]})}const Ie="0x35567e1a",Se=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Ve=[{type:"uint256",name:"nonce"}];async function Fe(t){return U({contract:t.contract,method:[Ie,Se,Ve],params:[t.sender,t.key]})}const Ne="0xa6193531",Me=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Re=[{type:"bytes32"}];async function $e(t){return U({contract:t.contract,method:[Ne,Me,Re],params:[t.userOp]})}const He="0x22cdde4c",Be=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],ke=[{type:"bytes32"}];async function je(t){return U({contract:t.contract,method:[He,Be,ke],params:[t.userOp]})}function ze(t){return t.factory?_([t.factory,t.factoryData||"0x"]):"0x"}function We(t){return _([D(O(t.verificationGasLimit),{size:16}),D(O(t.callGasLimit),{size:16})])}function qe(t){return _([D(O(t.maxPriorityFeePerGas),{size:16}),D(O(t.maxFeePerGas),{size:16})])}function Ke(t){return t.paymaster?_([t.paymaster,D(O(t.paymasterVerificationGasLimit||BigInt(0)),{size:16}),D(O(t.paymasterPostOpGasLimit||BigInt(0)),{size:16}),t.paymasterData||"0x"]):"0x"}const Je=t=>({sender:t.sender,nonce:t.nonce,initCode:ze(t),callData:t.callData,accountGasLimits:We(t),preVerificationGas:t.preVerificationGas,gasFees:qe(t),paymasterAndData:Ke(t),signature:t.signature});async function S(t){var A;const{userOp:e,paymasterOverride:a,client:n,chain:s,entrypointAddress:r}=t;if(a)return a(e);const o={"Content-Type":"application/json"},i=r??x,c=j(s),u=await dt(n)(c,{method:"POST",headers:o,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[q(e),i]})}),p=await u.json();if(!u.ok){const f=p.error||u.statusText,m=p.code||"UNKNOWN";throw new Error(`Paymaster error: ${f}
Status: ${u.status}
Code: ${m}`)}if(p.result)return typeof p.result=="string"?{paymasterAndData:p.result}:{paymasterAndData:p.result.paymasterAndData,verificationGasLimit:p.result.verificationGasLimit?w(p.result.verificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?w(p.result.preVerificationGas):void 0,callGasLimit:p.result.callGasLimit?w(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterData:p.result.paymasterData,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?w(p.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?w(p.result.paymasterPostOpGasLimit):void 0};const y=((A=p.error)==null?void 0:A.message)||p.error||u.statusText||"unknown error";throw new Error(`Paymaster error from ${c}: ${y}`)}const K=new Set,J=t=>`${t.chain.id}:${t.address}`,vt=t=>{K.add(J(t))},Ot=t=>{K.delete(J(t))},Z=t=>K.has(J(t));async function Ze(t){const e=t.timeoutMs||12e4,a=t.intervalMs||1e3,n=Date.now()+e;for(;Date.now()<n;){const s=await De(t);if(s)return s;await new Promise(r=>setTimeout(r,a))}throw new Error("Timeout waiting for userOp to be mined")}async function Ye(t){var h;const{transaction:e,accountContract:a,factoryContract:n,adminAddress:s,overrides:r,sponsorGas:o,waitForDeployment:i=!0}=t,c=e.chain,d=e.client,u={client:d,chain:c,entrypointAddress:r==null?void 0:r.entrypointAddress},p=pt(((h=t.overrides)==null?void 0:h.entrypointAddress)||x),[y,A,f,m,G]=await Promise.all([Bt(a),W(e),M(e.gas),Qe({executeTx:e,bundlerOptions:u,chain:c,client:d}),na({accountContract:a,chain:c,client:d,entrypointAddress:r==null?void 0:r.entrypointAddress,getNonceOverride:r==null?void 0:r.getAccountNonce})]),{maxFeePerGas:g,maxPriorityFeePerGas:l}=m;return p==="v0.7"?Xe({bundlerOptions:u,factoryContract:n,accountContract:a,adminAddress:s,sponsorGas:o,overrides:r,isDeployed:y,nonce:G,callData:A,callGasLimit:f,maxFeePerGas:g,maxPriorityFeePerGas:l,waitForDeployment:i}):ta({bundlerOptions:u,factoryContract:n,accountContract:a,adminAddress:s,sponsorGas:o,overrides:r,isDeployed:y,nonce:G,callData:A,callGasLimit:f,maxFeePerGas:g,maxPriorityFeePerGas:l,waitForDeployment:i})}async function Qe(t){const{executeTx:e,bundlerOptions:a,chain:n,client:s}=t;let{maxFeePerGas:r,maxPriorityFeePerGas:o}=e;const i=(a==null?void 0:a.bundlerUrl)??j(n);if(kt(i)){const c=await xe({options:a});r=c.maxFeePerGas,o=c.maxPriorityFeePerGas}else{const[c,d]=await Promise.all([M(r),M(o)]);if(c&&d)r=c,o=d;else{const u=await jt(s,n);o=d??u.maxPriorityFeePerGas??0n,r=c??u.maxFeePerGas??0n}}return{maxFeePerGas:r,maxPriorityFeePerGas:o}}async function Xe(t){const{bundlerOptions:e,isDeployed:a,factoryContract:n,accountContract:s,adminAddress:r,sponsorGas:o,overrides:i,nonce:c,callData:d,callGasLimit:u,maxFeePerGas:p,maxPriorityFeePerGas:y,waitForDeployment:A}=t,{chain:f,client:m}=e;let G,g;a||Z(s)?(g="0x",A&&await Tt(s)):(G=n.address,g=await W(wt({factoryContract:n,adminAddress:r,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount})),vt(s));const l={sender:s.address,nonce:c,callData:d,maxFeePerGas:p,maxPriorityFeePerGas:y,callGasLimit:u??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:G,factoryData:g,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:lt};if(o){const h=await S({userOp:l,chain:f,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});if(h.paymaster&&h.paymasterData&&(l.paymaster=h.paymaster,l.paymasterData=h.paymasterData),h.callGasLimit&&h.verificationGasLimit&&h.preVerificationGas&&h.paymasterPostOpGasLimit&&h.paymasterVerificationGasLimit)l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit;else{const T=await I({userOp:l,options:e});l.callGasLimit=T.callGasLimit,l.verificationGasLimit=T.verificationGasLimit,l.preVerificationGas=T.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n;const P=await S({userOp:l,chain:f,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});P.paymaster&&P.paymasterData&&(l.paymaster=P.paymaster,l.paymasterData=P.paymasterData)}}else{const h=await I({userOp:l,options:e});l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n}return{...l,signature:"0x"}}async function ta(t){const{bundlerOptions:e,isDeployed:a,factoryContract:n,accountContract:s,adminAddress:r,sponsorGas:o,overrides:i,nonce:c,callData:d,callGasLimit:u,maxFeePerGas:p,maxPriorityFeePerGas:y,waitForDeployment:A}=t,{chain:f,client:m}=e;let G;a||Z(s)?(G="0x",A&&await Tt(s)):(G=await aa({factoryContract:n,adminAddress:r,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount}),vt(s));const g={sender:s.address,nonce:c,initCode:G,callData:d,maxFeePerGas:p,maxPriorityFeePerGas:y,callGasLimit:u??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:lt};if(o){const l=await S({userOp:g,chain:f,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),h="paymasterAndData"in l?l.paymasterAndData:"0x";if(h&&h!=="0x"&&(g.paymasterAndData=h),l.callGasLimit&&l.verificationGasLimit&&l.preVerificationGas)g.callGasLimit=l.callGasLimit,g.verificationGasLimit=l.verificationGasLimit,g.preVerificationGas=l.preVerificationGas;else{const T=await I({userOp:g,options:e});if(g.callGasLimit=T.callGasLimit,g.verificationGasLimit=T.verificationGasLimit,g.preVerificationGas=T.preVerificationGas,h&&h!=="0x"){const P=await S({userOp:g,chain:f,client:m,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),F="paymasterAndData"in P?P.paymasterAndData:"0x";F&&F!=="0x"&&(g.paymasterAndData=F)}}}else{const l=await I({userOp:g,options:e});g.callGasLimit=l.callGasLimit,g.verificationGasLimit=l.verificationGasLimit,g.preVerificationGas=l.preVerificationGas}return{...g,signature:"0x"}}async function ea(t){const{userOp:e,chain:a,entrypointAddress:n,adminAccount:s}=t,r=pt(n||x);let o;if(r==="v0.7"){const i=Je(e);o=await je({contract:L({address:n||zt,chain:a,client:t.client}),userOp:i})}else o=await $e({contract:L({address:n||x,chain:a,client:t.client}),userOp:e});if(s.signMessage){const i=await s.signMessage({message:{raw:Wt(o)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function aa(t){const{factoryContract:e,adminAddress:a,accountSalt:n,createAccountOverride:s}=t,r=wt({factoryContract:e,adminAddress:a,accountSalt:n,createAccountOverride:s});return _([e.address,await W(r)])}async function na(t){const{accountContract:e,chain:a,client:n,entrypointAddress:s,getNonceOverride:r}=t;return r?r(e):Fe({contract:L({address:s||x,chain:a,client:n}),key:Te(),sender:e.address})}async function Tt(t){const e=Date.now();for(;Z(t);){if(Date.now()-e>6e4)throw Ot(t),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(a=>setTimeout(a,500))}}function sa(t){return t.id==="smart"}const Pt=new WeakMap,$=new WeakMap;async function ra(t,e,a){var f,m,G,g;const{personalAccount:n,client:s,chain:r}=e;if(!n)throw new Error("Personal wallet does not have an account");const o=a,i=o.factoryAddress??qt((f=a.overrides)==null?void 0:f.entrypointAddress),c=r??o.chain,d="gasless"in o?o.gasless:o.sponsorGas;if(await we(c))return[da({creationOptions:a,connectionOptions:e,chain:c,sponsorGas:d}),c];const u=L({client:s,address:i,chain:c}),p=await Ce({factoryContract:u,adminAddress:n.address,predictAddressOverride:(m=o.overrides)==null?void 0:m.predictAddress,accountSalt:(G=o.overrides)==null?void 0:G.accountSalt,accountAddress:(g=o.overrides)==null?void 0:g.accountAddress}).then(l=>l).catch(l=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${c.id}: ${(l==null?void 0:l.message)||"unknown error"}`,{cause:l})}),y=L({client:s,address:p,chain:c}),A=await oa({...o,chain:c,sponsorGas:d,personalAccount:n,accountContract:y,factoryContract:u,client:s});return Pt.set(n,t),$.set(t,n),[A,c]}async function ia(t){const e=$.get(t);e&&(Pt.delete(e),$.delete(t))}async function oa(t){const{accountContract:e}=t,a={address:Kt(e.address),async sendTransaction(n){var i,c,d;const s=(i=t.overrides)==null?void 0:i.erc20Paymaster;let r;if(s){await ca({accountContract:e,erc20Paymaster:s,options:t});const u=async()=>({paymasterAndData:te([s.address,s==null?void 0:s.token]),paymaster:s.address,paymasterData:"0x"});r=((c=t.overrides)==null?void 0:c.paymaster)||u}const o=bt({accountContract:e,transaction:n,executeOverride:(d=t.overrides)==null?void 0:d.execute});return H({executeTx:o,options:{...t,overrides:{...t.overrides,paymaster:r}}})},async sendBatchTransaction(n){var r;const s=Ue({accountContract:e,transactions:n,executeBatchOverride:(r=t.overrides)==null?void 0:r.executeBatch});return H({executeTx:s,options:t})},async signMessage({message:n}){const[{isContractDeployed:s},{readContract:r},{encodeAbiParameters:o},{hashMessage:i},{checkContractWalletSignature:c}]=await Promise.all([b(()=>import("./index-CrUjKI9_.js").then(f=>f.bM),__vite__mapDeps([0,1])),b(()=>import("./index-CrUjKI9_.js").then(f=>f.bK),__vite__mapDeps([0,1])),b(()=>import("./index-CrUjKI9_.js").then(f=>f.bJ),__vite__mapDeps([0,1])),b(()=>import("./hashMessage-CLhnMS1a.js"),__vite__mapDeps([2,0,1])),b(()=>import("./checkContractWalletSignature-pJfyYmvg.js"),__vite__mapDeps([3,4,0,1]))]);await s(e)||await at({options:t,account:a,accountContract:e});const u=i(n);let p=!1;try{await r({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),p=!0}catch{}let y;if(p){const f=o([{type:"bytes32"}],[u]);y=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:f}})}else y=await t.personalAccount.signMessage({message:n});if(await c({contract:e,message:n,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(n){var m,G,g;const s=mt(n),[{isContractDeployed:r},{readContract:o},{encodeAbiParameters:i},{checkContractWalletSignedTypedData:c}]=await Promise.all([b(()=>import("./index-CrUjKI9_.js").then(l=>l.bM),__vite__mapDeps([0,1])),b(()=>import("./index-CrUjKI9_.js").then(l=>l.bK),__vite__mapDeps([0,1])),b(()=>import("./index-CrUjKI9_.js").then(l=>l.bJ),__vite__mapDeps([0,1])),b(()=>import("./checkContractWalletSignedTypedData-CcMGEW_w.js"),__vite__mapDeps([5,4,0,1,6,7,8,9]))]);if(((G=(m=s.domain)==null?void 0:m.verifyingContract)==null?void 0:G.toLowerCase())===((g=e.address)==null?void 0:g.toLowerCase()))return t.personalAccount.signTypedData(s);await r(e)||await at({options:t,account:a,accountContract:e});const p=ue(s);let y=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),y=!0}catch{}let A;if(y){const l=i([{type:"bytes32"}],[p]);A=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:l}})}else A=await t.personalAccount.signTypedData(s);if(await c({contract:e,data:s,signature:A}))return A;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(n){var s,r;return(r=(s=t.personalAccount).onTransactionRequested)==null?void 0:r.call(s,n)}};return a}async function ca(t){var u;const{accountContract:e,erc20Paymaster:a,options:n}=t,s=a.token,r=L({address:s,chain:e.chain,client:e.client});if(await Ge({contract:r,owner:e.address,spender:a.address})>0n)return;const i=Jt({contract:r,spender:a.address,amountWei:ee-1n}),c=await Zt({transaction:i,from:e.address}),d=bt({accountContract:e,transaction:c,executeOverride:(u=n.overrides)==null?void 0:u.execute});await H({executeTx:d,options:{...n,overrides:{...n.overrides,erc20Paymaster:void 0}}})}function da(t){const{creationOptions:e,connectionOptions:a,chain:n}=t,s={address:a.personalAccount.address,async sendTransaction(r){var u,p,y,A;const o={data:r.data,to:r.to??void 0,value:r.value??0n,chain:Yt(r.chainId),client:a.client};let i=await Qt({account:s,transaction:o});if(t.sponsorGas){const f=await _e({options:{client:a.client,chain:n,bundlerUrl:(u=e.overrides)==null?void 0:u.bundlerUrl,entrypointAddress:(p=e.overrides)==null?void 0:p.entrypointAddress},transaction:i});i={...i,...f}}const c=await Xt({account:s,chainId:n.id,eip712Transaction:i});return{transactionHash:(await Ee({options:{client:a.client,chain:n,bundlerUrl:(y=e.overrides)==null?void 0:y.bundlerUrl,entrypointAddress:(A=e.overrides)==null?void 0:A.entrypointAddress},transaction:i,signedTransaction:c})).transactionHash,client:a.client,chain:n}},async signMessage({message:r}){return a.personalAccount.signMessage({message:r})},async signTypedData(r){const o=mt(r);return a.personalAccount.signTypedData(o)},async onTransactionRequested(r){var o,i;return(i=(o=a.personalAccount).onTransactionRequested)==null?void 0:i.call(o,r)}};return s}async function at(t){const{options:e,account:a,accountContract:n}=t,[{sendTransaction:s},{prepareTransaction:r}]=await Promise.all([b(()=>import("./index-CrUjKI9_.js").then(c=>c.bL),__vite__mapDeps([0,1])),b(()=>import("./index-CrUjKI9_.js").then(c=>c.bI),__vite__mapDeps([0,1]))]),o=r({client:e.client,chain:e.chain,to:n.address,value:0n,gas:50000n});return await s({transaction:o,account:a})}async function H(t){var c,d,u;const{executeTx:e,options:a}=t,n=await Ye({transaction:e,factoryContract:a.factoryContract,accountContract:a.accountContract,adminAddress:a.personalAccount.address,sponsorGas:a.sponsorGas,overrides:a.overrides}),s=await ea({client:a.client,chain:a.chain,adminAccount:a.personalAccount,entrypointAddress:(c=a.overrides)==null?void 0:c.entrypointAddress,userOp:n}),r={chain:a.chain,client:a.client,bundlerUrl:(d=a.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(u=a.overrides)==null?void 0:u.entrypointAddress},o=await Pe({options:r,userOp:s}),i=await Ze({...a,userOpHash:o});return Ot(a.accountContract),{client:a.client,chain:a.chain,transactionHash:i.transactionHash}}const ya=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:ra,disconnectSmartWallet:ia,isSmartWallet:sa},Symbol.toStringTag,{value:"Module"}));export{ue as h,ya as i};
